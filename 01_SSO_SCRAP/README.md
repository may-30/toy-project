# SSO SCRAP

## 0. Index

[1. 목적](#1-목적)

[2.필요 서비스](#2-필요-서비스)

[3. 상세 설명](#3-상세-설명)

- [3-1. crowl.py](#3-1-crowlpy)

- [3-2. sso.py](#3-2-ssopy)

- [3-3. excel.py](#3-3-excelpy)

- [3-4. main.py](#3-4-mainpy)

[4. 문제점 및 개선하고 싶은 사항](#4-문제점-및-개선하고-싶은-사항)

- [4-1. 문제점](#4-1-문제점)

- [4-2. 개선하고 싶은 사항](#4-2-개선하고-싶은-사항)

---

## 1. 목적

AWS IAM Identity Center(구, AWS SSO)를 사용하면서 SSO Group과 SSO User의 목록을 한눈에 보기 어렵다는 생각을 가지게 되어 자동화 구현으로 만들어보았습니다.

따라서 해당 자동화는 SSO Group과 SSO User가 하나의 엑셀 파일에 담도록 하는 목적을 담고 만들었습니다.

---

## 2. 필요 서비스

패키지의 경우 pip으로 설치하여 관리하였으며 python 버전은 `3.9` 입니다.

python 버전 관리의 경우 `conda`를 사용해서 관리하였습니다.

패키지 다운로드는 아래 명령어를 입력하면 됩니다.

```bash
pip install -r requirements.txt
```

---

## 3. 상세 설명

### 3-1. crowl.py

셀레니움 기반으로 브라우저 자동화를 통해서 AWS IAM Identity Center에서 제공하는 임시 자격증명 키 발급을 받는 역할을 합니다.

특히, AWS IAM Identity Center에서 발급되는 OTP를 사용하는 경우 OTP 발급 당시에 발급되는 고유키를 사용하여 Time Based OTP의 조건을 만족시킬 수 있도록 구현하였습니다.

AWS IAM Identity Center에서 제공하는 임시 자격증명 키를 발급 받기 위해서는 아이디, 패스워드, OTP 고유키를 사용해서 로그인 하는 로직을 통해 임시 자격증명 키(aws access key id, aws secret access key, aws session token)를 `Str 자료형`으로 반환합니다.

### 3-2. sso.py

전체 모듈에서 제일 핵심이 되는 역할을 담당하고 있습니디.

Boto3 기반으로 AWS IAM Identity Center에 등록되어 관리되는 SSO Group과 그에 매핑되어 있는 SSO User 정보를 전부 가져와서 `List 자료형`으로 반환합니다.

### 3-3. excel.py

관리 용이 목적으로 작성된 모듈이기 때문에 단순 터미널에 `print()` 함수를 사용하여 출력하는 것이 가독성 측면에서 좋지 않다는 판단을 하게 되었습니다.

때문에 터머닐이 아닌 excel 파일을 별도로 생성하여 출력하도록 구현하였습니다.

### 3-4. main.py

위에 기재한 `crowl.py`, `sso.py`, `excel.py`를 동작시키는 역할을 담당합니다.

뿐만 아니라 `crowl.py`에서 필요한 입력값들을 제공받습니다.

---

## 4. 문제점 및 개선하고 싶은 사항

### 4-1. 문제점

`crowl.py`에서 실제 접근이 가능한 AWS IAM Identity Center의 아이디, 패스워드, OTP 정보가 필요합니다.

상당히 보안적인 면에서 취약한 부분이지만 "만약 역할 제공이 되지 않으면?" 이라는 단순 호기심과 "브라우저 자동화"를 경험해보고 싶었기 떄문에 이러한 문제점을 알고 있음에도 불구하고 구현해보게 되었습니다.

### 4-2. 개선하고 싶은 사항

- A. 브라우저 자동화 중 `Selenium`은 특히 버전에 관련해서 이슈가 많이 있었습니다. 이를 해결하고자 `Playwright`로 마이그레이션을 해야 합니다.

- B. 브라우저 자동화 대신 `Boto3`에서 Role 기반으로 사용하여 더 보안적으로 구현해야 합니다.

---
